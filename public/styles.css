/* -------------------------------------------------------------
   TAPSI FOOD MAP DASHBOARD — Modernized styles.css
   - Visual refresh (hero header, timeline card, buttons/inputs)
   - Sidebar accordions with smooth open/close
   - Pruned fixed-position footer buttons (moved to footer bar)
   - Micro-interactions, focus-visible, toasts & legend shells
   ------------------------------------------------------------- */

/* --- Variables & Base --- */
:root {
  /* Brand & semantic */
  --primary-color: #2979FF;
  --primary-hover-color: #1C54B2;
  --secondary-color: #6c757d;
  --secondary-hover-color: #545b62;
  --success-color: #2e7d32;
  --success-hover-color: #1b5e20;
  --danger-color: #e53935;
  --warning-color: #fb8c00;

  /* Neutrals */
  --light-bg: #F7F9FC;
  --content-bg: #FFFFFF;
  --surface-1: #FFFFFF;
  --surface-2: #F4F6FA;
  --surface-3: #EEF2F7;

  --text-dark: #263238;
  --text-darker: #111827;
  --text-light: #FFFFFF;
  --text-muted: #6b7280;

  --border-color: #E3E8EF;
  --border-strong: #CFD8DC;

  /* Radii & shadow */
  --radius-sm: .375rem;
  --radius-md: .5rem;
  --radius-lg: .75rem;
  --shadow-sm: 0 2px 6px rgba(16,24,40,.06);
  --shadow-md: 0 8px 20px rgba(16,24,40,.08);
  --shadow-lg: 0 16px 32px rgba(16,24,40,.12);

  /* Sizing */
  --input-height: 2.5rem;
  --container-max: 1280px;

  /* Animation */
  --ease: cubic-bezier(.2,.8,.2,1);
  --fast: 150ms;
  --slow: 280ms;

  /* CLAUDE: EASY-TO-EDIT GRADIENT & COLOR VARIABLES */

  /* === PANEL BACKGROUND GRADIENTS === */
  /* Top header panel - contains "TAPSI FOOD MAP DASHBOARD" title */
  --header-grad-start: #322d47;     /* Header gradient start color */
  --header-grad-end:   #5b4c9ed0;   /* Header gradient end color */

  /* Right sidebar panel - contains all the filter controls */
  --sidebar-grad-start:#f0eeee;     /* Sidebar gradient start color (top) */
  --sidebar-grad-end:  #ebebeb;     /* Sidebar gradient end color (bottom) */

  /* View mode controls panel - contains "Live/Historical" toggle below header */
  --viewmode-grad-start:#c4c4c4;    /* View mode panel gradient start color */
  --viewmode-grad-end:  #eeeeeed0;    /* View mode panel gradient end color */

  /* === BUTTON COLORS === */
  /* Primary buttons (Apply All Filters, Save Changes, etc.) */
  --btn-primary-bg: #2979FF;        /* Primary button background */
  --btn-primary-hover: #00c70a;     /* Primary button hover background */

  /* Secondary buttons (Extract Visible Vendors, Clear, etc.) */
  --btn-secondary-bg: #383838;      /* Secondary button background */
  --btn-secondary-hover: #00c70a;   /* Secondary button hover background */

  /* Map type buttons (Total Order Density, User Density, etc.) */
  --btn-maptype-bg: #fcfcfc;        /* Map type button background */
  --btn-maptype-border: #E3E8EF;    /* Map type button border */
  --btn-maptype-hover-bg: #eef4ff;  /* Map type button hover background */
  --btn-maptype-hover-border: #2979FF; /* Map type button hover border */

  /* Active map type button */
  --btn-maptype-active-bg: #2e7d32;    /* Active map type button background */
  --btn-maptype-active-hover: #1b5e20; /* Active map type button hover background */

  /* === FOOTER COLORS === */
  /* Footer panel - contains "TAPSI FOOD MAP DASHBOARD - MULTI-PLATFORM EDITION" */
  --footer-bg: #FFFFFF;             /* Footer background color */
  --footer-text: #6b7280;           /* Footer text color */
  --footer-border: #E3E8EF;         /* Footer top border color */
}

*, *::before, *::after { box-sizing: border-box; }

html, body { height: 100%; }

body {
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans", sans-serif;
  margin: 0;
  background: var(--light-bg);
  color: var(--text-dark);
  display: flex;
  flex-direction: column;
  overflow: hidden; /* overridden when needed */
  font-size: 14px;
  line-height: 1.5;
  zoom: 67%;
}

/* Loading blur */
body.is-loading .dashboard-container > *:not(#map-loading-overlay-wrapper),
body.is-loading .footer-actions { filter: blur(5px); pointer-events: none; transition: filter var(--fast) var(--ease); }
body.is-loading { overflow: hidden !important; }

/* ---- Global helpers ---- */
.hidden { display: none !important; }
.chip {
  display: inline-flex; align-items: center; gap: .4rem;
  height: 24px; padding: 0 .6rem;
  border-radius: 999px; font-size: .75rem; font-weight: 600;
  background: var(--surface-3); color: var(--text-dark);
  border: 1px solid var(--border-color);
}
.chip.success { background: #e8f5e9; color: #1b5e20; border-color: #c8e6c9; }
.chip.warn    { background: #fff3e0; color: #e65100; border-color: #ffe0b2; }
.chip.danger  { background: #ffebee; color: #b71c1c; border-color: #ffcdd2; }

/* ---- Top Hero Header ---- */
.header {
  /* CLAUDE: now powered by editable variables (see section 4) */
  background: linear-gradient(135deg, var(--header-grad-start) 0%, var(--header-grad-end) 85%);
  color: var(--text-light);
  padding: .85rem 1.25rem; /* CLAUDE: slightly smaller, see #2 */
  box-shadow: var(--shadow-sm);
  position: sticky; top: 0; z-index: 10;
  text-align: center;          /* CLAUDE: center headline & subhead */
}
.header h1 { margin: .1rem 0 .25rem; font-size: 1.75rem; font-weight: 700; letter-spacing: .2px; }
.header p  { margin: 0; font-size: .9rem; opacity: .95; }

/* CLAUDE: status chip removed from UI */
.refresh-status { display: none !important; } /* keeps JS harmless */
.refresh-indicator { animation: pulse-refresh 2s ease-in-out infinite; }
.refresh-indicator.online  { color: #a7f3d0; }
.refresh-indicator.warning { color: #ffe082; }
.refresh-indicator.offline { color: #ffcdd2; }
.refresh-text { color: #fff; opacity: .95; }

/* ---- View Mode & Timeline Controls ---- */
.view-mode-controls {
  /* CLAUDE: apply editable gradient to view mode panel */
  background: linear-gradient(180deg, var(--viewmode-grad-start), var(--viewmode-grad-end));
  border-bottom: 1px solid var(--border-color);
  padding: 1rem 1.5rem;
  display: flex; flex-direction: column; gap: .9rem;
  box-shadow: var(--shadow-sm);
}

.view-mode-toggle { display: flex; align-items: center; gap: 1rem; }
.toggle-label { display: flex; align-items: center; gap: .75rem; font-weight: 600; color: var(--text-dark); }
.toggle-switch {
  display: flex; align-items: center; gap: .25rem;
  background: var(--surface-2);
  border: 1px solid var(--border-color);
  border-radius: var(--radius-lg);
  padding: .15rem;
}
.toggle-switch input[type="radio"] { display: none; }
.toggle-option {
  padding: .45rem .9rem;
  cursor: pointer; border-radius: calc(var(--radius-lg) - .15rem);
  color: var(--text-muted); font-size: .85rem; font-weight: 600;
  transition: background var(--fast) var(--ease), color var(--fast) var(--ease);
}
.toggle-switch input[type="radio"]:checked + .toggle-option {
  background: var(--primary-color); color: var(--text-light); box-shadow: var(--shadow-sm);
}
.toggle-option:hover { color: var(--text-dark); }
.toggle-switch input[type="radio"]:checked + .toggle-option:hover { background: var(--primary-hover-color); color: #fff; }

/* --- Historical flash --- */
.historical-flash-notification {
  background: linear-gradient(135deg, var(--primary-color), #1976D2);
  color: #fff; border-radius: var(--radius-md);
  padding: .75rem 1rem; margin-bottom: .5rem; box-shadow: var(--shadow-md);
  display: none;
}
.flash-content { display: flex; align-items: center; gap: .75rem; }
.flash-icon { font-size: 1.1rem; }
.flash-text { flex: 1; font-weight: 600; font-size: .9rem; }
.flash-dismiss {
  background: rgba(255,255,255,.22); border: none; color: white;
  width: 28px; height: 28px; border-radius: 50%; cursor: pointer;
  display: grid; place-items: center; font-size: 1.1rem; font-weight: 700;
  transition: background var(--fast) var(--ease);
}
.flash-dismiss:hover { background: rgba(255,255,255,.32); }

/* --- Timeline Card --- */
.timeline-controls {
  background: var(--surface-1);
  border: 1px solid var(--border-color);
  border-top: 3px solid var(--primary-color);
  border-radius: var(--radius-lg);
  box-shadow: var(--shadow-md);
  overflow: hidden;
}
.timeline-header {
  display: flex; justify-content: space-between; align-items: center;
  padding: .9rem 1rem;
  background: var(--surface-1);
}
.timeline-info { display: flex; align-items: center; gap: .75rem; }
.timeline-label   { font-weight: 700; color: var(--text-darker); font-size: .95rem; }
.timeline-timestamp { color: var(--primary-color); font-weight: 700; font-size: .85rem; font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace; }
.timeline-collapse-btn {
  background: none; border: 1px solid var(--border-color);
  color: var(--text-muted); cursor: pointer; padding: .35rem;
  border-radius: var(--radius-sm); transition: all var(--fast) var(--ease);
  display: grid; place-items: center; min-width: 32px; height: 32px;
}
.timeline-collapse-btn:hover { background: var(--surface-2); color: var(--text-dark); }
.collapse-icon { transition: transform var(--slow) var(--ease); }
.timeline-controls.collapsed .collapse-icon { transform: rotate(180deg); }

.timeline-content { padding: 1rem; transition: max-height var(--slow) var(--ease), opacity var(--fast) var(--ease); max-height: 1000px; opacity: 1; }
.timeline-controls.collapsed .timeline-content { max-height: 0; opacity: 0; padding-top: 0; padding-bottom: 0; overflow: hidden; }

/* Status pills row */
.timeline-status { margin: .5rem 0 1rem; padding: .75rem; background: var(--surface-2); border: 1px solid var(--border-color); border-radius: var(--radius-md); }
.timeline-details { display: flex; flex-wrap: wrap; gap: .75rem 1rem; align-items: center; justify-content: space-between; }
.timeline-hour-info, .timeline-datetime, .timeline-vendor-count { font-size: .85rem; color: var(--text-dark); }
.timeline-hour-info strong, .timeline-datetime strong, .timeline-vendor-count strong { color: var(--text-darker); }

/* Playback */
.playback-controls {
  display: flex; align-items: center; justify-content: center; gap: .5rem;
  margin: .5rem 0; padding: .5rem; background: var(--surface-2);
  border: 1px solid var(--border-color); border-radius: var(--radius-md);
}
.playback-btn {
  padding: .55rem; background: var(--surface-1);
  border: 1px solid var(--border-color); border-radius: var(--radius-sm);
  cursor: pointer; font-size: 1.05rem; min-width: 40px; height: 40px; display: grid; place-items: center;
  transition: transform var(--fast) var(--ease), box-shadow var(--fast) var(--ease), background var(--fast) var(--ease), color var(--fast) var(--ease);
  color: var(--text-dark);
}
.playback-btn:hover { background: var(--primary-color); color: #fff; border-color: var(--primary-color); transform: translateY(-1px); box-shadow: var(--shadow-sm); }
.playback-btn:active { transform: translateY(0); box-shadow: none; }
.playback-btn:disabled { opacity: .55; cursor: not-allowed; transform: none !important; box-shadow: none !important; }
.playback-btn.playing { background: var(--success-color); color: #fff; border-color: var(--success-color); }

.playback-speed { display: flex; align-items: center; gap: .5rem; margin-left: 1rem; padding-left: 1rem; border-left: 1px solid var(--border-color); }
.playback-speed label { font-size: .85rem; font-weight: 600; color: var(--text-dark); }
.speed-select {
  padding: .25rem .5rem; border: 1px solid var(--border-color); border-radius: var(--radius-sm);
  background: var(--surface-1); color: var(--text-dark); font-size: .82rem; cursor: pointer;
  transition: border-color var(--fast) var(--ease);
}
.speed-select:hover, .speed-select:focus { border-color: var(--primary-color); outline: none; }

/* Slider */
.timeline-slider-container { position: relative; }
.timeline-slider {
  width: 100%; height: 8px; border-radius: 999px;
  background: var(--border-color); outline: none; opacity: .9; transition: opacity var(--fast);
  margin-bottom: .5rem; cursor: pointer; -webkit-appearance: none; appearance: none;
}
.timeline-slider:hover { opacity: 1; }
.timeline-slider::-webkit-slider-thumb {
  -webkit-appearance: none; appearance: none; width: 18px; height: 18px; border-radius: 50%;
  background: var(--primary-color) !important; cursor: pointer; box-shadow: 0 0 0 6px rgba(41,121,255,.15);
  transition: transform var(--fast) var(--ease), background var(--fast) var(--ease);
}
.timeline-slider::-webkit-slider-thumb:hover { background: var(--primary-hover-color); transform: scale(1.06); }
.timeline-slider::-moz-range-thumb {
  width: 18px; height: 18px; border-radius: 50%; background: var(--primary-color) !important; cursor: pointer; border: none;
  box-shadow: 0 0 0 6px rgba(41,121,255,.15);
}
.timeline-labels { display: flex; justify-content: space-between; font-size: .75rem; color: var(--text-muted); }
.timeline-start, .timeline-end { font-weight: 600; }

/* ---- Top filters row ---- */
.filters-top, .filters-maptype {
  display: flex; flex-wrap: wrap; gap: .75rem 1rem; align-items: flex-start;
  padding: .75rem 1rem; background: var(--surface-1); border-bottom: 1px solid var(--border-color);
}
.filter-item { display: flex; flex-direction: column; min-width: 150px; }
.filter-item-custom-dropdown { min-width: 220px; }
.filter-item-textarea { min-width: 240px; }

.filter-item label {
  font-size: .75rem; margin-bottom: .25rem; color: var(--text-muted);
  font-weight: 700; text-transform: uppercase; letter-spacing: .02em;
}

/* Inputs & Selects */
.filter-item select,
.filter-item input[type="date"],
.filter-item input[type="text"],
.filter-item input[type="number"],
.filter-item input[type="color"],
.custom-checkbox-dropdown .dropdown-button {
  height: var(--input-height); padding: 0 .8rem;
  border: 1px solid var(--border-color); border-radius: var(--radius-md);
  background: var(--surface-1); color: var(--text-dark); font-size: .9rem;
  transition: border-color var(--fast) var(--ease), box-shadow var(--fast) var(--ease), background var(--fast) var(--ease);
}
.filter-item input[type="color"] { padding: .1rem; width: 52px; }
.filter-item textarea {
  min-height: calc(var(--input-height) * 1.5);
  padding: .6rem .8rem; border: 1px solid var(--border-color); border-radius: var(--radius-md);
  background: var(--surface-1); color: var(--text-dark); font-size: .9rem; resize: vertical;
}
.filter-item select:focus,
.filter-item input[type="date"]:focus,
.filter-item input[type="text"]:focus,
.filter-item input[type="number"]:focus,
.custom-checkbox-dropdown .dropdown-button:focus,
.filter-item textarea:focus {
  border-color: var(--primary-color); outline: 0; box-shadow: 0 0 0 .18rem rgba(41,121,255,.18);
}

/* Buttons */
button, .button {
  height: var(--input-height); padding: 0 1rem;
  border-radius: var(--radius-md); border: 1px solid transparent;
  cursor: pointer; font-size: .9rem; font-weight: 600;
  display: inline-flex; align-items: center; justify-content: center; gap: .5rem;
  transition: background var(--fast) var(--ease), border-color var(--fast) var(--ease), color var(--fast) var(--ease), transform var(--fast) var(--ease), box-shadow var(--fast) var(--ease);
}
/* CLAUDE: use editable button color variables */
.btn-primary { background: var(--btn-primary-bg); color: #fff; border-color: var(--btn-primary-bg); }
.btn-primary:hover { background: var(--btn-primary-hover); border-color: var(--btn-primary-hover); transform: translateY(-1px); box-shadow: var(--shadow-sm); }

.btn-secondary { background: var(--btn-secondary-bg); color: #fff; border-color: var(--btn-secondary-bg); }
.btn-secondary:hover { background: var(--btn-secondary-hover); border-color: var(--btn-secondary-hover); transform: translateY(-1px); box-shadow: var(--shadow-sm); }

.btn-toggle {
  background: var(--surface-1); color: var(--primary-color); border: 1px solid var(--primary-color);
}
.btn-toggle.active, .btn-toggle:hover { background: var(--primary-color); color: #fff; }

.btn-small { height: 2rem; font-size: .78rem; padding: 0 .6rem; }

/* CLAUDE: Map type buttons with editable colors */
.filters-maptype button {
  background: var(--btn-maptype-bg); color: var(--text-dark); border: 1px solid var(--btn-maptype-border);
}
.filters-maptype button:hover { background: var(--btn-maptype-hover-bg); border-color: var(--btn-maptype-hover-border); }
.filters-maptype button.active-map-type { background: var(--btn-maptype-active-bg); color: #fff; border-color: var(--btn-maptype-active-bg); }
.filters-maptype button.active-map-type:hover { background: var(--btn-maptype-active-hover); border-color: var(--btn-maptype-active-hover); }

/* ---- Main Content & Map ---- */
.dashboard-container { display: flex; flex-direction: column; height: 100%; }
.main-content { display: flex; flex: 1; overflow: hidden; position: relative; }
#map { flex: 1; height: 100%; background: #e0e0e0; }

/* Map Loading Overlay */
#map-loading-overlay-wrapper{
  position: fixed; inset: 0; z-index: 10000;
  display: flex; align-items: center; justify-content: center;
  color: #fff; font-weight: 800; font-size: 1.6rem; text-shadow: 1px 1px 3px rgba(0,0,0,.4);
  background: rgba(0,0,0,.3); transition: opacity var(--slow) var(--ease), visibility var(--slow) var(--ease);
  opacity: 0; visibility: hidden;
}
#map-loading-overlay-wrapper.visible{ opacity: 1; visibility: visible; }

/* No-data overlay */
#map-nodata-overlay{
  position:absolute; inset:0; z-index: 1000; display:flex; align-items:center; justify-content:center;
  background: rgba(224,224,224,.7); color: var(--text-muted); font-weight: 600; font-size: 1.05rem; text-align:center;
}

/* ---- Sidebar (now accordionized) ---- */
.sidebar-filters {
  width: 300px; padding: 1rem;
  /* CLAUDE: enable an easy-to-edit gradient on the right panel */
  background: linear-gradient(180deg, var(--sidebar-grad-start), var(--sidebar-grad-end));
  border-left: 1px solid var(--border-color); overflow: auto;
  display: flex; flex-direction: column; gap: .9rem; box-shadow: -2px 0 5px rgba(0,0,0,.03);
}

/* Accordion wrappers using <details> */
details.accordion {
  background: var(--surface-1);
  border: 1px solid var(--border-color);
  border-radius: var(--radius-lg);
  box-shadow: var(--shadow-sm);
  overflow: clip;
  transition: box-shadow var(--fast) var(--ease), border-color var(--fast) var(--ease);
}
details.accordion[open] { box-shadow: var(--shadow-md); border-color: #d7e3ff; }

details.accordion > summary {
  list-style: none; cursor: pointer; user-select: none;
  padding: .9rem 1rem; position: relative; font-weight: 800; color: var(--text-darker);
  background: linear-gradient(0deg, var(--surface-1) 0%, var(--surface-2) 100%);
}
details.accordion > summary::-webkit-details-marker { display: none; }
details.accordion > summary::after {
  content: '▾'; position: absolute; right: 12px; top: 50%; transform: translateY(-50%) rotate(0deg);
  transition: transform var(--slow) var(--ease); color: var(--text-muted);
}
details.accordion[open] > summary::after { transform: translateY(-50%) rotate(-180deg); }
details.accordion .accordion-content { padding: .75rem 1rem 1rem; display: grid; gap: .75rem; }

/* Legacy headers inside sidebar still look good */
.sidebar-filters h4 {
  margin: 0.25rem 0 .35rem; font-size: .9rem; font-weight: 800; color: var(--text-dark);
  text-transform: uppercase; letter-spacing: .02em;
  padding-bottom: .35rem; border-bottom: 1px dashed #eaecef;
}
.sidebar-filters hr { border: 0; border-top: 1px dashed var(--border-color); margin: .5rem 0; }

.sidebar-filters .filter-item label.checkbox-label { font-size: .85rem; font-weight: 500; color: var(--text-dark); margin-left: .25rem; }
.sidebar-filters .filter-item input[type="checkbox"]{ width: 16px; height: 16px; vertical-align: middle; }

/* --- CSV & Lat/Lng group + refresh controls --- */
.filter-item-group{
  display: flex; align-items: flex-end; gap: .75rem; flex-wrap: wrap;
  border-left: 2px solid var(--border-color); padding-left: 1rem; margin-left: 1rem;
}
.filter-item-group .filter-item { min-width: 120px; }

.refresh-controls{ display: flex; flex-direction: column; gap: .5rem; margin-left: .5rem; padding-left: .75rem; border-left: 2px solid var(--border-color); }
.refresh-timer-group{
  display:flex; align-items:center; gap:.5rem; background: var(--surface-2);
  padding:.4rem .6rem; border-radius: var(--radius-sm); border:1px solid var(--border-color);
}
.refresh-timer{ display:flex; flex-direction:column; align-items:flex-start; min-width:68px; }
.timer-label{ font-size:.65rem; color:var(--text-muted); font-weight:700; text-transform:uppercase; line-height:1; margin-bottom:.1rem; }
.timer-value{ font-size:.8rem; font-weight:800; color:var(--primary-color); font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Courier New", monospace; line-height:1; }
.timer-value.refreshing{ color: var(--warning-color); animation: pulse-refresh 1s ease-in-out infinite; }
.btn-refresh{
  background: var(--surface-1); border:1px solid var(--border-color); color: var(--text-muted);
  padding:.3rem .5rem; border-radius: var(--radius-sm); cursor: pointer; font-size:.85rem; min-width:34px; height:30px;
  display:flex; align-items:center; justify-content:center; transition: all var(--fast) var(--ease);
}
.btn-refresh:hover{ background: var(--surface-2); border-color: var(--primary-color); color: var(--primary-color); transform: translateY(-1px); }
.btn-refresh.refreshing{ animation: spin 1s linear infinite; opacity:.75; pointer-events:none; background: var(--warning-color); color:#fff; border-color: var(--warning-color); }

/* --- Heatmap/Grid/Radius misc from original (tidied) ---- */
#heatmap-auto-optimize.active, #heatmap-smooth-transitions.active {
  background: var(--success-color); color: #fff; border-color: var(--success-color);
}
#heatmap-auto-optimize.active:hover, #heatmap-smooth-transitions.active:hover {
  background: var(--success-hover-color); border-color: var(--success-hover-color);
}
.leaflet-coverageGridPane-pane { transition: filter var(--slow) var(--ease), opacity var(--slow) var(--ease); }

/* Radius controls modes */
#radius-fixed-control, #radius-percentage-control, #radius-grade-dynamic-control { transition: opacity var(--slow) var(--ease); }
#radius-fixed-control[style*="display: none"],
#radius-percentage-control[style*="display: none"],
#radius-grade-dynamic-control[style*="display: none"] { opacity: 0; }

/* Range inputs – unify style (blue) */
input[type="range"]{ -webkit-appearance:none !important; appearance:none !important; background:#CFD8DC !important; border-radius:2px !important; height:4px !important; }
input[type="range"]::-webkit-slider-thumb{
  -webkit-appearance:none !important; appearance:none !important;
  background:#2979FF !important; border:none !important; height:16px !important; width:16px !important; border-radius:50% !important;
  cursor:pointer !important; box-shadow:0 2px 4px rgba(41,121,255,.3) !important;
}
input[type="range"]::-moz-range-thumb{
  background:#2979FF !important; border:none !important; height:16px !important; width:16px !important; border-radius:50% !important;
  cursor:pointer !important; box-shadow:0 2px 4px rgba(41,121,255,.3) !important;
}
input[type="range"]::-webkit-slider-track{ background:#CFD8DC !important; height:4px !important; border-radius:2px !important; }
input[type="range"]::-moz-range-track{ background:#CFD8DC !important; height:4px !important; border-radius:2px !important; border:none !important; }

/* Labels that show dynamic values in sidebar */
.sidebar-filters .filter-item label[for^="heatmap-"],
.sidebar-filters .filter-item label[for^="grid-"],
.sidebar-filters .filter-item label[for="vendor-marker-size"],
.sidebar-filters .filter-item label[for^="vendor-radius"]{
  display:flex; justify-content:space-between; align-items:center;
}
.sidebar-filters .filter-item label span { font-weight: 800; color: var(--primary-color); }

/* Custom checkbox dropdown */
.custom-checkbox-dropdown{ position: relative; }
.custom-checkbox-dropdown .dropdown-button{
  display:flex; align-items:center; justify-content:space-between; width:100%;
  text-align:left; cursor:pointer; padding-right:2rem; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;
}
.custom-checkbox-dropdown .dropdown-button::after{
  content:'▼'; font-size:.8em; position:absolute; right:.75rem; top:50%; transform:translateY(-50%); color:var(--text-muted); pointer-events:none;
}
.custom-checkbox-dropdown .dropdown-button.open::after{ content:'▲'; }
.custom-checkbox-dropdown .dropdown-panel{
  display:none; position:absolute; background:var(--surface-1); border:1px solid var(--border-color); border-radius: var(--radius-md);
  margin-top: 2px; max-height: 180px; overflow-y: scroll; z-index: 1050; width: 100%; min-width: 220px; box-shadow: var(--shadow-md);
}
.custom-checkbox-dropdown .dropdown-panel.open{ display:block; }
.custom-checkbox-dropdown .dropdown-panel-item{
  padding:.45rem .75rem; cursor:pointer; display:flex; align-items:center; border-bottom:1px solid #f3f4f6; font-size:.88rem;
}
.custom-checkbox-dropdown .dropdown-panel-item:last-child{ border-bottom:none; }
.custom-checkbox-dropdown .dropdown-panel-item:hover{ background:#eef4ff; }
.custom-checkbox-dropdown .dropdown-panel-item input[type="checkbox"]{ margin-right:.6rem; width:16px; height:16px; }
.custom-checkbox-dropdown .dropdown-panel-item label{
  font-weight:500; color:var(--text-dark); text-transform:none; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; flex:1; margin:0; cursor:pointer;
}

/* Leaflet popup polish */
.leaflet-popup-content-wrapper{ border-radius: var(--radius-md); box-shadow: var(--shadow-lg); }
.leaflet-popup-content{ font-size: .9rem; line-height: 1.45; }
.leaflet-popup-content b{ font-size: .98rem; color: var(--primary-color); }

/* ---- Footer ---- */
/* CLAUDE: footer with editable colors */
.footer {
  padding: .65rem 1.25rem; background: var(--footer-bg);
  border-top: 1px solid var(--footer-border); color: var(--footer-text); flex-shrink: 0;
}
.footer-content {
  /* CLAUDE: center caption while pinning actions right */
  max-width: var(--container-max); margin: 0 auto; position: relative;
  display: flex !important; align-items: center !important; justify-content: center !important; gap: 1rem;
  min-height: 3rem; /* ensure enough height for proper positioning */
}
.footer-content p{
  margin: 0; font-size: .8rem; color: var(--footer-text);
  text-align: center !important;
  position: absolute !important;
  left: 50% !important;
  transform: translateX(-50%) !important;
  white-space: nowrap;
}

/* Footer action area (place buttons here in index.html) */
.footer-actions {
  /* CLAUDE: float action buttons to the right, independent of centered caption */
  position: absolute !important;
  right: 0 !important;
  top: 50% !important;
  transform: translateY(-50%) !important;
  display: flex !important;
  gap: .5rem;
  align-items: center;
  z-index: 10; /* ensure buttons are above other content */
}
.footer-actions .btn-primary, .footer-actions .btn-secondary { min-width: 160px; }

/* ------ PRUNED LEGACY: fixed-position buttons (neutralized) ----
   We intentionally remove the fixed positioning so actions live in footer.
------------------------------------------------------------------ */
.btn-apply-fixed, .btn-extract-fixed {
  position: static !important;
  bottom: auto !important; right: auto !important; z-index: auto !important;
  min-width: auto; box-shadow: none; margin: 0; /* they’ll be placed in .footer-actions */
}

/* ---- Validation states ---- */
.filter-item.error input,
.filter-item.error select,
.filter-item.error textarea { border-color: var(--danger-color); box-shadow: 0 0 0 .18rem rgba(229,57,53,.18); }
.filter-item.error label { color: var(--danger-color); }

.filter-item.success input,
.filter-item.success select,
.filter-item.success textarea { border-color: var(--success-color); box-shadow: 0 0 0 .18rem rgba(46,125,50,.18); }
.filter-item.success label { color: var(--success-color); }

/* ---- Availability & Delivery Rate inputs ---- */
.availability-input{ width: 120px !important; min-width: 120px; font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Courier New", monospace; text-align:center; }
.availability-input::placeholder{ color: var(--text-muted); font-style: italic; }

.delivery-rate-controls{ display:flex; align-items:center; gap:.5rem; flex-wrap:wrap; }
.delivery-rate-range{ display:flex; align-items:center; gap:.5rem; flex:1; }
.delivery-rate-input{ width: 84px !important; min-width: 84px; font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Courier New", monospace; text-align:center; }
.delivery-rate-input::placeholder{ color: var(--text-muted); font-style: italic; }
.range-separator{ color: var(--text-muted); font-weight: 700; font-size: .85rem; }
.btn-clear-range{
  background: var(--secondary-color); color: #fff; border: none; border-radius: var(--radius-sm);
  padding: .3rem .55rem; font-size: .75rem; cursor: pointer; transition: background var(--fast);
}
.btn-clear-range:hover{ background: var(--secondary-hover-color); }
.btn-clear-range:active{ transform: translateY(1px); }

/* ---- Grid section ---- */
#grid-visualization-section { transition: all var(--slow) var(--ease); overflow: visible; }
#grid-visualization-section h4 { color: var(--primary-color); font-size: .9rem; }
#grid-visualization-section .filter-item:first-child small{
  background: var(--surface-2); padding: .5rem; border-radius: var(--radius-sm); border-left: 3px solid var(--primary-color);
}

/* ---- Dynamic Targets Modal ---- */
.modal{ position: fixed; inset: 0; z-index: 10000; display: none; align-items: center; justify-content: center; background: rgba(0,0,0,.45); }
.modal-content{
  background: var(--surface-1); border-radius: var(--radius-lg); box-shadow: var(--shadow-lg);
  /* CLAUDE: larger modal */
  width: min(96%, 980px);       /* was 740px */
  max-height: 90vh;             /* was 82vh  */
  display: flex; flex-direction: column; overflow: hidden;
  border: 1px solid var(--border-color);
}
.modal-header{ display:flex; justify-content:space-between; align-items:center; padding: 1.1rem 1.25rem; border-bottom: 1px solid var(--border-color); }
.modal-header h3{ margin:0; color: var(--primary-color); font-size: 1.25rem; }
.modal-close{
  background: none; border: 1px solid var(--border-color); color: var(--text-muted); cursor: pointer;
  padding: .25rem .5rem; border-radius: var(--radius-sm); transition: background var(--fast);
}
.modal-close:hover{ background: var(--surface-2); color: var(--text-dark); }
.modal-body{ padding: 1rem; overflow:auto; flex:1; }
.modal-info{ background: var(--surface-2); padding: .75rem; border-radius: var(--radius-md); margin-bottom: 1rem; border-left: 3px solid var(--primary-color); }
.modal-info p{ margin: 0 0 .45rem; font-size: .92rem; }
.modal-info p:last-of-type{ margin-bottom: .7rem; }
.modal-footer{ display:flex; justify-content:flex-end; gap:.75rem; padding: 1rem 1.25rem; border-top: 1px solid var(--border-color); background: var(--surface-2); }

.dynamic-target-area-modal{ margin-bottom: .75rem; padding: .75rem; border: 1px solid var(--border-color); border-radius: var(--radius-md); background: var(--surface-1); }
.dynamic-target-area-modal h4{
  margin: 0 0 .5rem; color: var(--primary-color); font-size: .98rem; font-weight: 800; padding-bottom: .25rem;
  border-bottom: 1px solid var(--border-color);
}
.dynamic-target-item-modal{ display:flex; align-items:center; justify-content:space-between; padding:.5rem 0; border-bottom: 1px solid var(--surface-3); }
.dynamic-target-item-modal:last-child{ border-bottom: none; }
.dynamic-target-label-modal{ font-size:.92rem; font-weight:600; color: var(--text-dark); flex:1; }
.dynamic-target-input-container{ display:flex; align-items:center; gap:.5rem; flex-wrap:wrap; }
.dynamic-target-input-modal{ width: 110px; padding:.5rem; border:1px solid var(--border-color); border-radius: var(--radius-sm); font-size:.9rem; text-align:right; }
.dynamic-target-default{ font-size:.8rem; color: var(--text-muted); font-style: italic; }

/* ---- Toasts (for Apply/Extract confirmations) ---- */
.toast-container{
  position: fixed; right: 16px; bottom: 16px; z-index: 11000;
  display: grid; gap: .5rem;
}
.toast{
  background: var(--surface-1); border: 1px solid var(--border-color);
  border-left: 4px solid var(--primary-color);
  color: var(--text-dark); padding: .75rem 1rem; border-radius: var(--radius-md);
  box-shadow: var(--shadow-md); min-width: 260px; display: flex; align-items: center; gap: .6rem;
}
.toast.success{ border-left-color: var(--success-color); }
.toast.warn{ border-left-color: var(--warning-color); }
.toast.error{ border-left-color: var(--danger-color); }

/* ---- Legend shell (optional, for heatmap etc.) ---- */
.legend-card{
  position: absolute; left: 16px; bottom: 16px; z-index: 900;
  background: var(--surface-1); border: 1px solid var(--border-color);
  border-radius: var(--radius-md); box-shadow: var(--shadow-sm);
  padding: .6rem .8rem; font-size: .85rem; color: var(--text-dark);
}

/* ---- Responsive tweaks ---- */
@media (max-width: 768px){
  .view-mode-controls { padding: .75rem 1rem; }
  .view-mode-toggle { flex-direction: column; align-items: flex-start; gap: .5rem; }
  .timeline-details { flex-direction: column; align-items: flex-start; gap: .4rem; }
  .playback-controls { flex-wrap: wrap; gap: .35rem; }
  .playback-speed { margin-left: 0; padding-left: 0; border-left: none; border-top: 1px solid var(--border-color); padding-top: .5rem; margin-top: .4rem; width: 100%; justify-content: center; }
  .playback-btn { min-width: 42px; height: 42px; font-size: 1.15rem; }

  .sidebar-filters { width: 100%; max-height: 55vh; border-left: none; border-top: 1px solid var(--border-color); }
  .main-content { flex-direction: column; }
  .filters-top, .filters-maptype { flex-direction: column; gap: .5rem; }
  .filter-item-group{ flex-direction: column; align-items: stretch; border-left: none; padding-left: 0; margin-left: 0; border-top: 1px solid var(--border-color); padding-top: .75rem; margin-top: .75rem; }
  .refresh-controls{ margin-left: 0; padding-left: 0; border-left: none; border-top: 1px solid var(--border-color); padding-top: .5rem; margin-top: .5rem; }
}

/* ---- Scrollbars (sidebar only) ---- */
.sidebar-filters::-webkit-scrollbar{ width: 8px; }
.sidebar-filters::-webkit-scrollbar-track{ background: var(--light-bg); }
.sidebar-filters::-webkit-scrollbar-thumb{ background: var(--border-color); border-radius: 4px; }
.sidebar-filters::-webkit-scrollbar-thumb:hover{ background: #c6ccd4; }

/* ---- Scrollbars (dropdown panels) ---- */
.custom-checkbox-dropdown .dropdown-panel::-webkit-scrollbar{ width: 10px; }
.custom-checkbox-dropdown .dropdown-panel::-webkit-scrollbar-track{ background: #f1f3f4; border-radius: 5px; }
.custom-checkbox-dropdown .dropdown-panel::-webkit-scrollbar-thumb{ background: #c1c7cd; border-radius: 5px; border: 1px solid #e1e5e9; }
.custom-checkbox-dropdown .dropdown-panel::-webkit-scrollbar-thumb:hover{ background: #9ca3af; }

/* ---- Tooltips ---- */
[title]{ position: relative; cursor: help; }

/* ---- Animations ---- */
@keyframes pulse-refresh{ 0%,100%{opacity:1} 50%{opacity:.6} }
@keyframes spin{ from{transform:rotate(0)} to{transform:rotate(360deg)} }

/* ---- Focus visibility for accessibility ---- */
:focus-visible{
  outline: 3px solid rgba(41,121,255,.35);
  outline-offset: 2px;
  transition: outline-offset var(--fast);
}
